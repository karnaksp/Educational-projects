# Ansible


**Ansible** - инструмент автоматизации удаленного конфигурирования узла. Его основным свойством является отсутствие какой-либо агент-серверной структуры. Вместо этого Ansible можно установить лишь на одну машину (которая не обязательно является каким-либо менеджером или крупным важным узлом в топологии сети), важно лишь иметь возможность установки соединения. **Ansible** подключается по **ssh** и выполняет обычные bash-команды. Помимо этого **Ansible** собирает обратную информацию или *факты* об удаленных машинах, которые позволяют **Ansible** не только изменять состояние конфигурации узла, но и хранить информацию об изменениях этого состояния и гарантировать неизменность этого состояние со стороны конфигуратора (так как сам узел естественно остается "незащищенным" для ручного конфигурирования).


Чтобы начать работу с **Ansible** необходимо создать inventory-файл содержащий в себе адреса или доменные имена всех удаленных хостов требующих конфигурации. В случае с виртуальными машинами Vagrant это будут ip-адреса во внутренней сети Vagrant.


Теперь чтобы запустить некоторое действие или модуль с помощью ansible на всех подключенных машинах нужно выполнить следующую команду:


`ansible all --key-file <путь до ssh ключа> -i <путь до inventory-файла> -m <имя модуля>` .


Официальная документация содержит информацию о всех доступных модулях. Используйте `man ansible` для ознакомления с другими ключами, некоторые из которых могут, например, понадобиться для выполнения команд с привилегиями рута.


Множество команд для ansible можно объединять в один yml-файл - плейбук (playbook). Простейший плейбук имеет следующую структуру:


```yml
- hosts: <группа>               # по умолчанию - all
 <ключ №1>: <значение №1>      # дополнительные ключи и аргументы по аналогии с ansible
 <ключ №2>: <значение №2>
 <ключ №2>: <значение №3>
 tasks:                        # список задач
   - name: <имя задачи №1>     # имя задачи
     <имя модуля>:             # модуль и его параметры
       <параметр №1>: <значение №1>
       <параметр №2>: <значение №2>
       <параметр №3>: <значение №3>
   - name: <имя задачи №2>     # имя задачи
     <имя модуля>:             # модуль и его параметры
       <параметр №1>: <значение №1>
       <параметр №2>: <значение №2>
       <параметр №3>: <значение №3>
   <...>
```


Для запуска плейбука введите команду:


`ansible-playbook <имя плейбука>`


Плейбуки **Ansible** поддерживают создание ролей. Роли позволяют логически выделять команды в отдельные файлы, расположенные в специфичной древовидной структуре директорий:


```
./roles/
----role1/
--------tasks/
------------main.yml            //задачи первой роли
----role2/
--------tasks/
------------main.yml            //задачи второй роли
----role3/
--------tasks/
------------main.yml            //задачи третьей роли
```


Помимо задач в ролях можно устанавливать свои шаблоны (templates), переменные (vars) и другие полезные вещи.



